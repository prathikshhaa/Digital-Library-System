<!DOCTYPE html>
<html>
<head>
    <title>Borrowed Books</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">
    <style>
        body { margin:0; font-family:'Roboto', sans-serif; background:#111; color:#fff; text-align:center; }
        h1 { margin:20px 0; }
        .book-card { background: rgba(255,255,255,0.1); border-radius:12px; padding:15px; margin:15px auto; max-width:600px;}
        .alert { margin-top:10px; padding:10px; border-radius:8px; font-weight:bold;}
        .alert-success { background: rgba(0,200,0,0.7);}
        .alert-danger { background: rgba(255,0,0,0.7);}
    </style>
</head>
<body>
    <h1>üìö Borrowed Books & Deadlines</h1>
    <div id="borrowed-list"></div>

    <script>
        async function loadBorrowed() {
            const user_id = prompt("Enter your User ID");
            const res = await fetch(`/history/${user_id}/data`);
            const books = await res.json();
            const list = document.getElementById('borrowed-list');
            list.innerHTML = '';

            if(books.length===0) { list.innerHTML="<p>No borrowed books yet.</p>"; return; }

            books.forEach(book=>{
                const borrowDate = new Date(book.borrow_date);
                const dueDate = new Date(borrowDate);
                dueDate.setDate(dueDate.getDate()+15);
                const today = new Date();
                const daysLeft = Math.ceil((dueDate-today)/(1000*60*60*24));
                let fine = 0, statusClass='alert-success', statusText='';

                if(daysLeft>0) statusText=`‚úÖ Due in ${daysLeft} day(s)`;
                else { fine=Math.abs(daysLeft)*5; statusText=`‚ùå Overdue! Fine: ‚Çπ${fine}`; statusClass='alert-danger'; }

                const card = document.createElement('div');
                card.className='book-card';
                card.innerHTML=`
                    <h3>${book.title}</h3>
                    <p>Borrowed On: ${borrowDate.toDateString()}</p>
                    <p>Due Date: ${dueDate.toDateString()}</p>
                    <div class="alert ${statusClass}">${statusText}</div>
                `;
                list.appendChild(card);
            });
        }

        window.onload = loadBorrowed;
    </script>
</body>
</html>
